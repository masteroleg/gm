# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project

Website for [genu.im](https://genu.im) — a product authenticity verification and transparency platform. Two client sources: (1) regulatory-driven (eAkciz mandate via xtrace.gov.ua) and (2) voluntary brand protection. Pure HTML/CSS/JS, no framework. Backend: existing TraceAvit Azure API (closed by auth).

### Product vision (from PRD work, 2026-02-19)

Three epics, one platform:

| Epic | Scope | URL | Stack |
|------|-------|-----|-------|
| **1. Landing** | Main page — unified trust narrative for all audiences | `genu.im/` | Static HTML+Tailwind |
| **2. Verification** | Product passports by vertical + future API verification | `genu.im/v/{code}` | Static HTML+JS+JSON |
| **3. B2B Portal** | Client dashboard, codes, production, 10+ screens | `genu.im/portal/` | SPA, MSAL.js Azure AD |

**Key decisions:**
- `/v/genuim` — predefined code: platform showcase (the "product" = genu.im itself)
- `/v/genuim-alco`, `/v/genuim-tobacco` etc. — vertical-specific passports (same template, different theme+content via JSON + CSS vars)
- Real code verification (`/v/XXXXXX`) — Phase 2 when API opens for consumer access
- `SUSPICIOUS_CHECK_THRESHOLD = 5` — configurable constant for nbChecks warning
- Actions: P=Надруковано, V=Перевірено системою, C=Перевірено покупцем, W=Списано
- Ukrainian first, English second
- Visual language: "Quiet Strength" — Diia-principle (works instantly, respects user's time), champagne+green, zero drama
- Epics 1+2: GitHub Pages. Epic 3: migrate to Azure Static Web Apps
- Epic 3 framework choice deferred to Architecture Doc

**Three audiences, three emotional triggers:**
- CEO/Owner → Fear (fines, counterfeits)
- Marketing → Opportunity (scan analytics, ROI)
- Consumer → Safety ("is it real? is it safe?")

**Competitor insight:** Sytecs (sytecs.com.ua) + xtrace.com.ua — no consumer-facing verification. Their xtrace.com.ua mimics gov site. genu.im positions through transparency, not mimicry.

## Commands

```bash
# Develop
npm run dev          # Watch Tailwind CSS changes (runs tailwindcss --watch)
npm start            # Serve site locally at http://localhost:3000

# Build
npm run build:css    # Compile & minify Tailwind CSS (input.css → output.css)

# Test
npm test             # Jest unit tests
npm run test:e2e     # Playwright E2E tests (requires local server running first)

# E2E with local server in one step
npm start &          # Start server in background, then:
BASE_URL=http://localhost:3000 npx playwright test

# Run a single Playwright test file
npx playwright test tests/e2e/genuim.spec.js
npx playwright test tests/e2e/genuim.spec.js --project=chromium

# Run a specific test by name
npx playwright test -g "theme toggle"
```

## Architecture

### File layout

- `index.html` — single-page HTML, all content lives here
- `assets/css/input.css` — Tailwind v4 source with full custom theme variables
- `assets/css/output.css` — compiled CSS (do not edit directly, generated by build)
- `assets/js/theme-toggle.js` — dark/light mode logic
- `assets/js/lang-toggle.js` — EN/UK i18n switcher
- `assets/js/menu.js` — mobile burger menu open/close
- `tests/e2e/` — Playwright specs
- `tests/` — Jest unit tests + manual browser console tests

### Key design decisions

**FOUC prevention:** An inline `<script>` in `<head>` runs before DOM render, setting the `.dark` class and `data-theme` attribute on `<html>` from localStorage (or system preference). Any theme-related JS changes must consider this early script.

**Theme system:** Tailwind v4 custom CSS variables define two palettes — "Champagne & Ivory" (light) and "Midnight Sapphire" (dark). The `.dark` class on `<html>` switches between them. `data-theme` attribute mirrors the active theme for Playwright selectors.

**i18n:** `lang-toggle.js` holds an embedded translation object for EN/UK. Elements with `data-i18n` attributes get their text replaced on language switch. Language and theme selections are persisted in `localStorage`.

**CSS build:** Tailwind CSS v4 via `@tailwindcss/cli`. Source is `assets/css/input.css`; output is `assets/css/output.css`. The stylesheet is linked as a blocking `<link>` (not preloaded) to prevent CLS.

**CRITICAL — `assets/css/output.css` must stay committed in git.** GitHub Pages deploys static files directly from the repo with no build step. Removing this file from git tracking (e.g. `git rm --cached`) will break the live site — all styling disappears. The file must not be added to `.gitignore`. The E2E test `CSS is loaded and applied` detects this regression via a CSS custom property check.

**Husky hooks:** Both `.husky/pre-commit` and `.husky/pre-push` run `npm run build:css`, keeping `output.css` in sync. Use `--no-verify` only as a last resort.

**Mobile menu:** Nav menu has `hidden` class by default. `menu.js` removes/adds it on burger/close button clicks.

### Testing notes

- E2E tests in `tests/e2e/genuim.spec.js` cover theme toggle, language toggle, mobile menu, localStorage persistence, and required elements.
- CI runs Chromium only (`--project=chromium`). Local dev runs Chromium + Firefox + WebKit.
- Playwright `baseURL` defaults to `http://localhost:3000`; override with `BASE_URL` env var.
- Jest unit tests use `jsdom` environment; `tests/setup.js` mocks `localStorage` and `window.matchMedia`.
